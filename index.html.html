<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premios Recreativos - Tienda Oficial</title>
    
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Montserrat:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --gold: #ff3333; 
            --gold-acc: #B48F3A;
            --dark-bg: #0a0a0a;
            --light-text: #FFFFFF;
            --dark-text: #212121;
        }

        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Montserrat', sans-serif; 
            background-color: var(--dark-bg); 
            color: var(--light-text); 
            margin: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }
        
        /* --- ESTRUCTURA --- */
        .page-content { display: none; min-height: 100vh; box-sizing: border-box; }
        .page-content.active { display: block; animation: fadeInPage 0.8s forwards; }
        
        .page-content:not(#page-inicio) {
            padding: 120px 40px 40px;
            background-image: linear-gradient(rgba(10, 10, 10, 0.85), rgba(10, 10, 10, 0.85)), url('https://i.imgur.com/6eyxZxO.jpeg');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
        }
        .container { max-width: 1200px; width: 100%; margin: 0 auto; text-align: center; }

        @keyframes fadeInPage { from { opacity: 0; } to { opacity: 1; } }

        /* --- HEADER --- */
        .main-header { position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; box-sizing: border-box; background-color: rgba(10, 10, 10, 0.8); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255, 255, 255, 0.08); transition: background-color 0.3s ease; }
        .logo img { height: 50px; width: 52px; object-fit: cover; cursor: pointer; }
        .desktop-nav { display: flex; gap: 30px; align-items: center; }
        .desktop-nav a { position: relative; font-weight: 500; color: var(--light-text); text-decoration: none; transition: color 0.3s ease; cursor: pointer; text-transform: uppercase; font-size: 0.9rem; letter-spacing: 1px; padding-bottom: 5px; }
        .desktop-nav a::after { content: ''; position: absolute; bottom: 0; left: 50%; width: 100%; height: 1.5px; background-color: var(--gold-acc); transform: translateX(-50%) scaleX(0); transform-origin: center; transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1); }
        .desktop-nav a:hover, .desktop-nav a.active { color: var(--gold-acc); }
        .desktop-nav a:hover::after, .desktop-nav a.active::after { transform: translateX(-50%) scaleX(1); }
        .desktop-nav a.cta-button { background-color: transparent; color: var(--gold) !important; border: 1px solid var(--gold); padding: 10px 25px; border-radius: 30px; font-weight: 800; transition: all 0.3s ease; }
        .desktop-nav a.cta-button:hover { background-color: var(--gold); color: var(--light-text) !important; transform: scale(1.05); }
        .desktop-nav a.cta-button::after { display: none; }
        
        .menu-toggle { display: none; z-index: 1001; background: transparent; border: none; cursor: pointer; }
        .menu-toggle span { display: block; width: 30px; height: 3px; background: white; margin: 6px 0; }
        .mobile-nav { display: flex; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(10, 10, 10, 0.98); backdrop-filter: blur(15px); flex-direction: column; gap: 30px; transform: translateY(-100%); transition: transform 0.5s cubic-bezier(0.76, 0, 0.24, 1); z-index: 999; }
        .mobile-nav.nav-open { transform: translateY(0); }
        .mobile-nav a { font-family: 'Playfair Display', serif; font-size: 2rem; color: var(--light-text); text-decoration: none; }

        /* --- BOTONES --- */
        .btn, .filter-btn { font-family: 'Montserrat', sans-serif; font-size: 1rem; font-weight: 700; color: var(--gold-acc); background-color: rgba(0,0,0,0.3); padding: 12px 30px; text-decoration: none; border-radius: 30px; border: 1px solid var(--gold-acc); transition: all 0.3s; cursor: pointer; display: inline-block; text-transform: uppercase; letter-spacing: 1px; }
        .btn:hover, .filter-btn:hover, .filter-btn.active { background-color: var(--gold-acc); color: var(--dark-bg); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(180, 143, 58, 0.4); }

        /* --- ANIMACIONES --- */
        .reveal-on-scroll { opacity: 0; transform: translateY(60px); filter: blur(10px); transition: opacity 1s cubic-bezier(0.5, 0, 0, 1), transform 1s cubic-bezier(0.5, 0, 0, 1), filter 1s cubic-bezier(0.5, 0, 0, 1); transition-delay: var(--stagger-delay, 0s); }
        .reveal-on-scroll.is-visible { opacity: 1; transform: translateY(0); filter: blur(0); }

        /* --- GENERAL --- */
        .section-title { font-family: 'Playfair Display', serif; font-size: clamp(2.5rem, 8vw, 4.5rem); line-height: 1.1; margin-bottom: 20px; color: var(--gold-acc); text-shadow: 2px 2px 10px rgba(0,0,0,0.5); }
        .section-subtitle { font-size: 1.1rem; max-width: 700px; margin: 0 auto 40px; color: #ccc; line-height: 1.6; }

        /* --- HOME --- */
        #page-inicio { padding: 0; }
        .homepage-scroll-container { height: 100vh; overflow-y: scroll; scroll-snap-type: y mandatory; }
        .homepage-section { height: 100vh; width: 100%; scroll-snap-align: start; display: flex; justify-content: center; align-items: center; text-align: center; position: relative; padding: 40px; box-sizing: border-box; overflow: hidden; }
        .background-video { position: absolute; top: 50%; left: 50%; min-width: 100%; min-height: 100%; width: auto; height: auto; transform: translateX(-50%) translateY(-50%); z-index: 0; object-fit: cover; }
        .intro-section { background-size: cover; background-position: center; }
        .homepage-section .hero-title { font-family: 'Playfair Display'; font-size: clamp(3rem, 10vw, 6rem); color: white; text-shadow: 2px 2px 15px rgba(0,0,0,0.8); margin: 0; opacity: 0; animation: fadeInUp 1s cubic-bezier(0.5, 0, 0, 1) forwards 0.2s; }
        .homepage-section .hero-subtitle { color: var(--gold-acc); font-size: 1.5rem; letter-spacing: 3px; text-transform: uppercase; text-shadow: 2px 2px 10px rgba(0,0,0,0.8); opacity: 0; animation: fadeInUp 1s cubic-bezier(0.5, 0, 0, 1) forwards 0.6s; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        #page-inicio .intro-section .content { background-color: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); padding: 50px 60px; border-radius: 12px; max-width: 700px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }

        /* --- GRIDS & CARDS --- */
        .editions-grid, .nominee-grid, .category-year-grid { display: grid; gap: 30px; }
        .editions-grid { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .nominee-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
        .filters-container { display: flex; justify-content: center; gap: 15px; margin-bottom: 40px; flex-wrap: wrap; }

        /* TARJETA EDICIONES */
        .card { 
            background-image: url('https://i.imgur.com/6eyxZxO.jpeg'); 
            background-size: cover; border-radius: 10px; cursor: pointer; border: 2px solid #444; 
            transition: all 0.5s ease; min-height: 150px; position: relative; overflow: hidden;
            display: flex; flex-direction: column; justify-content: center;
        }
        .card:hover { border-color: var(--gold-acc); transform: translateY(-5px); }
        .card-content-wrapper { background: rgba(0,0,0,0.85); padding: 20px; height: 100%; display: flex; flex-direction: column; justify-content: center; width: 100%; box-sizing: border-box; z-index: 5; }
        .card h3 { color: var(--gold-acc); margin: 0; font-family: 'Playfair Display'; font-size: 1.5rem; text-align: center; }
        
        .results-comparison { display: flex; flex-direction: column; gap: 10px; overflow: hidden; max-height: 0; opacity: 0; transition: all 0.6s ease; margin-top: 0; }
        .card.state-nominees-revealed .results-comparison { max-height: 500px; opacity: 1; margin-top: 20px; }
        .nominee-result { display: flex; align-items: center; gap: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 50px; transition: all 0.5s ease; border: 1px solid transparent; }
        .nominee-result img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        
        .card.state-winner-announced { transform: scale(1.15) !important; z-index: 100; box-shadow: 0 0 50px rgba(180, 143, 58, 0.8) !important; border-color: #fff !important; }
        .editions-grid:has(.state-winner-announced) .card:not(.state-winner-announced) { filter: blur(4px) grayscale(80%); opacity: 0.4; transform: scale(0.95); transition: all 0.5s ease; }
        .card.state-winner-announced::after { content: ''; position: absolute; top:0; left:0; width:100%; height:100%; background-color: white; pointer-events: none; animation: winner-flash 0.6s ease-out forwards; z-index: 20; }
        @keyframes winner-flash { 0% { background-color: rgba(255,255,255,0.9); } 100% { background-color: transparent; } }
        .card.state-winner-announced .nominee-result[data-winner="true"] { background: rgba(180, 143, 58, 0.15); border: 2px solid var(--gold-acc); transform: scale(1.1); z-index: 10; box-shadow: 0 0 30px var(--gold-acc); }
        .card.state-winner-announced .nominee-result:not([data-winner="true"]) { opacity: 0.2; filter: blur(2px); }

        /* NOMINADOS */
        .nominee-card { position: relative; cursor: pointer; transition: all 0.3s ease; overflow: hidden; aspect-ratio: 9/16; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: #111; }
        .nominee-card:hover { transform: translateY(-8px); border-color: var(--gold-acc); }
        .nominee-card img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
        .nominee-card:hover img { transform: scale(1.05); }
        .nominee-info { position: absolute; bottom: 0; left: 0; right: 0; padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); color: white; z-index: 2; text-align: center; font-family: 'Playfair Display'; font-size: 1.2rem; }

        /* GALERIA MASONRY */
        .gallery-grid { column-count: 4; column-gap: 20px; margin-top: 30px; }
        @media (max-width: 1024px) { .gallery-grid { column-count: 3; } }
        @media (max-width: 768px) { .gallery-grid { column-count: 2; } }
        .gallery-item-wrapper { break-inside: avoid; margin-bottom: 20px; }
        .gallery-item { position: relative; border-radius: 12px; overflow: hidden; background: #000; box-shadow: 0 4px 15px rgba(0,0,0,0.5); border: 1px solid #333; cursor: pointer; transition: all 0.4s ease; }
        .gallery-item img, .gallery-item video { width: 100%; height: auto; display: block; transition: transform 0.8s ease; }
        .gallery-item:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(180, 143, 58, 0.3); border-color: var(--gold-acc); z-index: 10; }
        .gallery-item:hover img, .gallery-item:hover video { transform: scale(1.1); }
        .gallery-overlay { position:absolute; top:0; left:0; width:100%; height:100%; background:linear-gradient(to top, #000 0%, transparent 50%); opacity:0; transition:0.3s; display:flex; align-items:flex-end; justify-content:center; padding-bottom:20px;}
        .gallery-item:hover .gallery-overlay { opacity:1; }
        .gallery-caption {color:var(--gold-acc); font-weight:bold; letter-spacing:2px;}

        /* --- TIENDA --- */
        .shop-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px; margin-top: 40px; }
        .product-card { background: #111; border: 1px solid #333; border-radius: 12px; overflow: hidden; transition: all 0.3s; padding: 20px; display:flex; flex-direction: column; text-align: center; }
        .product-card:hover { border-color: var(--gold-acc); transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .product-image { height: 250px; background: #000; margin-bottom: 20px; border-radius: 8px; overflow:hidden; display: flex; justify-content: center; align-items: center;}
        .product-image img { width: 100%; height: 100%; object-fit: cover; }
        .product-price { color: var(--gold-acc); font-family: 'Playfair Display'; font-size: 1.5rem; margin: 10px 0; }
        .product-select { background: #222; border: 1px solid #444; color: white; padding: 10px; width: 100%; margin: 10px 0; border-radius: 6px; }

        /* CART FLOATING */
        #floating-cart-btn { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; border-radius: 50%; background: var(--gold-acc); color: black; display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 2000; font-size: 24px; box-shadow: 0 5px 20px rgba(0,0,0,0.5); transition: 0.3s; }
        #floating-cart-btn:hover { transform: scale(1.1); background: white; }
        .cart-counter { position: absolute; top: 0; right: 0; background: red; color: white; font-size: 12px; width: 20px; height: 20px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; border: 2px solid #000; }
        
        #cart-modal .modal-content { width: 95%; max-width: 600px; padding: 0; }
        .cart-header { padding: 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; background: #1a1a1a; }
        .cart-body { padding: 20px; max-height: 50vh; overflow-y: auto; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #333; }
        .cart-item-info { text-align: left; }
        .cart-total { padding: 20px; text-align: right; font-size: 1.5rem; color: var(--gold-acc); border-top: 1px solid #333; }
        .cart-actions { padding: 20px; text-align: center; background: #1a1a1a; }
        .remove-btn { color: red; cursor: pointer; margin-left: 15px; font-weight: bold; }

        /* --- VOTACIONES --- */
        #registration-container, #thank-you-step { max-width: 500px; margin: 50px auto; padding: 40px; background: rgba(10, 10, 10, 0.95); border: 1px solid var(--gold); border-radius: 15px; position: relative; z-index: 10; }
        #multi-step-container { display: none; padding-bottom: 50px; }
        .progress-bar-container { width: 100%; background: rgba(255,255,255,0.1); height: 6px; border-radius: 5px; margin-bottom: 30px; }
        #progress-bar { height: 100%; width: 0%; background: var(--gold); transition: width 0.3s; }
        .form-step { display: none; animation: fadeInPage 0.5s; }
        .form-step.active { display: block; }
        
        .voting-options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; justify-content: center; }
        /* CLASE ESPECIAL PARA DUPLAS (HORIZONTAL) */
        .voting-options-grid.mode-wide { grid-template-columns: 1fr; }
        @media (min-width: 768px) { .voting-options-grid.mode-wide { grid-template-columns: repeat(2, 1fr); } }

        .voting-option-wrapper { position: relative; cursor: pointer; }
        .voting-option-wrapper input { position: absolute; opacity: 0; }
        .voting-card { height: 400px; border-radius: 15px; overflow: hidden; position: relative; background: #111; border: 2px solid transparent; transition: all 0.3s; }
        
        /* CARD OVERRIDE FOR DUPLAS */
        .voting-options-grid.mode-wide .voting-card { aspect-ratio: 16/9; height: auto; min-height: 200px; }

        /* IMAGEN DE VOTACI√ìN */
        .voting-card img, .voting-card video { width: 100%; height: 100%; object-fit: cover; object-position: top center; }
        .voting-card-overlay { position: absolute; bottom: 0; left: 0; width: 100%; height: 60%; background: linear-gradient(to top, black, transparent); display: flex; flex-direction: column; justify-content: flex-end; padding: 20px; text-align: left; }
        
        .voting-option-wrapper input:checked + .voting-card { border-color: var(--gold); transform: scale(1.02); box-shadow: 0 0 30px var(--gold); }
        .form-navigation { display: flex; justify-content: space-between; margin-top: 40px; }
        .form-group input { width: 100%; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid #444; color: white; border-radius: 8px; margin-bottom: 15px; }
        
        /* BOT√ìN VER V√çDEO */
        .vote-watch-btn {
            position: absolute; top: 15px; right: 15px;
            background: rgba(0, 0, 0, 0.7); border: 1px solid var(--gold);
            color: var(--gold); font-size: 0.7rem; font-weight: bold;
            padding: 5px 12px; border-radius: 20px; cursor: pointer; z-index: 20; transition: all 0.3s ease;
        }
        .vote-watch-btn:hover { background: var(--gold); color: black; transform: scale(1.1); }

        /* --- INTRO CINEM√ÅTICA --- */
        #cinematic-intro { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 30000; display: none; justify-content: center; align-items: center; }
        #cinematic-intro.playing { display: flex; animation: fadeOutIntro 0.5s ease 3s forwards; }
        .intro-text { font-family: 'Playfair Display'; font-size: 4rem; color: transparent; background: linear-gradient(45deg, var(--gold), #fff, var(--gold)); -webkit-background-clip: text; background-clip: text; text-align: center; opacity: 0; transform: scale(0.8); animation: introTextAnim 3s forwards; }
        @keyframes introTextAnim { 0% {opacity:0; transform:scale(0.8)} 20%{opacity:1; transform:scale(1)} 80%{opacity:1; transform:scale(1.1)} 100%{opacity:0; transform:scale(1.2)} }
        @keyframes fadeOutIntro { to {opacity:0; visibility:hidden;} }

        /* --- BAL√ìN DE ORO --- */
        #balon-oro-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 20000; display: none; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.5s ease; }
        #balon-oro-overlay video { width: 100%; height: 100%; object-fit: contain; }
        #balon-oro-overlay.visible { display: flex; opacity: 1; }

        /* --- BUSCADOR --- */
        #search-input { width: 100%; max-width: 600px; padding: 15px 20px; font-size: 1.2rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(0,0,0,0.3); color: white; margin-bottom: 40px; }
        #search-results-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; list-style: none; padding: 0; }
        .search-result-item { display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; cursor: pointer; transition: 0.3s; }
        .search-result-item:hover { background: rgba(180, 143, 58, 0.1); border-color: var(--gold-acc); }
        .search-result-item img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
        .category-year-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .category-card-minimal { aspect-ratio: 1; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; cursor: pointer; transition: 0.3s; }
        .category-card-minimal:hover { border-color: var(--gold-acc); background: rgba(180, 143, 58, 0.15); transform: translateY(-5px); }

        /* --- MODALES --- */
        .modal { display: none; position: fixed; z-index: 10002; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); backdrop-filter: blur(5px); justify-content: center; align-items: center; }
        .modal.active { display: flex; animation: fadeInPage 0.3s; }
        .modal-close-btn { position: absolute; top: 20px; right: 30px; color: white; font-size: 40px; cursor: pointer; z-index: 20; }
        #nominee-modal .modal-content { display: grid; grid-template-columns: 45% 55%; width: 95%; max-width: 1000px; border: 1px solid var(--gold); border-radius: 15px; overflow: hidden; background: #050505; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        #nominee-modal img { width: 100%; height: 100%; object-fit: cover; display:block; }
        .nominee-modal-details { padding: 50px; display: flex; flex-direction: column; justify-content: center; text-align: left; }
        .nominee-stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .stat-box h5 { color: var(--gold-acc); margin: 0; }
        .lightbox-content { max-width: 90vw; max-height: 90vh; }
        .lightbox-content img, .lightbox-content video { max-width: 100%; max-height: 90vh; }
        #search-detail-modal .modal-content { max-width: 500px; background: #111; border: 1px solid var(--gold); padding: 40px; text-align: center; }
        #search-detail-modal img { width: 120px; height: 120px; border-radius: 50%; margin-bottom: 20px; border: 3px solid var(--gold-acc); }

        /* --- NIEVE --- */
        .snowflake { position: fixed; top: -10px; color: #fff; user-select: none; z-index: 99999; pointer-events: none; animation-name: fall; animation-timing-function: linear; animation-iteration-count: infinite; }
        @keyframes fall { to { transform: translateY(110vh); } }
        #snow-btn { position: fixed; bottom: 30px; left: 30px; width: 50px; height: 50px; border-radius: 50%; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.3); color: white; font-size: 24px; cursor: pointer; z-index: 1005; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        #snow-btn:hover { background: rgba(255, 255, 255, 0.3); transform: scale(1.1); }

        footer { padding: 50px; text-align: center; border-top: 1px solid #222; margin-top: 50px; color: #666; }
        @media (max-width: 768px) { .desktop-nav { display: none; } .menu-toggle { display: block; } #nominee-modal .modal-content { grid-template-columns: 1fr; max-height: 80vh; overflow-y: auto; } .nominee-modal-image-container { height: 350px; } }
    </style>
</head>
<body>
    
    <header class="main-header" id="main-header">
        <div class="logo" onclick="app.showPage('page-inicio')"><img src="https://i.imgur.com/TpQo4hy.png" alt="Logo"></div>
        <nav class="desktop-nav">
            <a data-target="page-inicio" class="active">Inicio</a>
            <a data-target="page-tienda" style="color:var(--gold-acc); font-weight:900;">Tienda</a>
            <a data-target="page-ediciones">Ediciones</a>
            <a data-target="page-nominados">Nominados</a>
            <a data-target="page-galeria">Galer√≠a</a>
            <a data-target="page-busqueda">Buscador</a>
            <a data-target="page-votaciones" class="cta-button">Desempate</a>
        </nav>
        <button id="menu-toggle-btn" class="menu-toggle"><span></span><span></span><span></span></button>
    </header>
    
    <nav class="mobile-nav" id="mobile-nav">
        <a data-target="page-inicio">Inicio</a>
        <a data-target="page-tienda">Tienda</a>
        <a data-target="page-ediciones">Ediciones</a>
        <a data-target="page-nominados">Nominados</a>
        <a data-target="page-galeria">Galer√≠a</a>
        <a data-target="page-busqueda">Buscador</a>
        <a data-target="page-votaciones" style="color: var(--gold);">Votar Desempate</a>
    </nav>

    <!-- Bot√≥n de Nieve -->
    <button id="snow-btn" onclick="toggleSnow()">‚ùÑÔ∏è</button>
    
    <!-- Bot√≥n Carrito Flotante (Se muestra en la tienda) -->
    <div id="floating-cart-btn" onclick="openCartModal()" style="display:none;">
        üõí <div class="cart-counter" id="cart-counter">0</div>
    </div>

    <main>
        <!-- HOME -->
        <div id="page-inicio" class="page-content active">
            <div class="homepage-scroll-container">
                <section class="homepage-section">
                    <video autoplay loop muted playsinline class="background-video"><source src="https://i.imgur.com/jWEVbe5.mp4" type="video/mp4"></video>
                    <div class="overlay"></div>
                    <div class="content" style="position:relative; z-index:2;">
                        <h1 class="hero-title hero-animated">Premios Recreativos</h1>
                        <p class="hero-subtitle hero-animated delay-1">El Desempate</p>
                    </div>
                </section>
                <section class="homepage-section intro-section" style="background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=1770&auto=format&fit=crop');">
                    <div class="content reveal-on-scroll">
                        <h2 class="section-title">La Boutique</h2>
                        <p class="section-subtitle">¬°Ya disponible! Compra tus sobres.</p>
                        <button class="btn" data-target="page-tienda">VISITAR TIENDA</button>
                    </div>
                </section>
                <section class="homepage-section intro-section" style="background-image: url('https://i.imgur.com/di0Nh4g.jpeg');">
                    <div class="content reveal-on-scroll"><h2 class="section-title">La Gala</h2><p class="section-subtitle">Revive cada edici√≥n.</p><button class="btn" data-target="page-ediciones">Explorar Ediciones</button></div>
                </section>
                <section class="homepage-section intro-section" style="background-image: url('https://i.imgur.com/lP2ndEf.jpeg');">
                    <div class="content reveal-on-scroll"><h2 class="section-title">La Galer√≠a</h2><p class="section-subtitle">Im√°genes eternas.</p><button class="btn" data-target="page-galeria">Visitar Archivos</button></div>
                </section>
            </div>
        </div>
        
        <!-- TIENDA -->
        <div id="page-tienda" class="page-content">
             <div class="container">
                 <h2 class="section-title reveal-on-scroll">Boutique Recreativa</h2>
                 <p class="section-subtitle reveal-on-scroll">Coleccionismo de √©lite para gente de bien.</p>
                 <div class="shop-grid" id="shop-container"></div>
             </div>
        </div>

        <!-- EDICIONES -->
        <div id="page-ediciones" class="page-content">
             <div class="container">
                 <h2 class="section-title reveal-on-scroll">Sal√≥n de la Fama</h2>
                 <div id="editions-nav-container" style="margin-bottom:40px;"></div> 
                 <div id="editions-grid-container" class="editions-grid"></div>
             </div>
        </div>

        <!-- NOMINADOS -->
        <div id="page-nominados" class="page-content">
             <div class="container">
                 <h2 class="section-title reveal-on-scroll">Censo de Leyendas</h2>
                 <div class="filters-container reveal-on-scroll" id="nominee-filters" style="margin-bottom:30px;">
                     <button class="filter-btn active" data-filter="all">Todos</button>
                     <button class="filter-btn" data-filter="Organizaci√≥n">Organizaci√≥n</button>
                     <button class="filter-btn" data-filter="Nominado">Nominados</button>
                     <button class="filter-btn" data-filter="Invitado">Invitados</button>
                 </div>
                 <div id="nominee-grid-container" class="nominee-grid"></div>
             </div>
        </div>

        <!-- GALER√çA -->
        <div id="page-galeria" class="page-content">
             <div class="container">
                 <h2 class="section-title reveal-on-scroll">Galer√≠a</h2>
                 <div class="filters-container reveal-on-scroll" id="gallery-filters" style="margin-bottom:30px;">
                     <button class="filter-btn active" data-filter="2024">2024</button>
                     <button class="filter-btn" data-filter="2023">2023</button>
                     <button class="filter-btn" data-filter="2022">2022</button>
                 </div>
                 <div id="gallery-grid-container" class="gallery-grid"></div>
             </div>
        </div>

        <!-- BUSCADOR -->
        <div id="page-busqueda" class="page-content">
             <div class="container">
                 <h2 class="section-title reveal-on-scroll">Buscador Universal</h2>
                 <input type="text" id="search-input" class="reveal-on-scroll" placeholder="Buscar por nombre...">
                 <ul id="search-results-container" class="reveal-on-scroll"></ul>
                 <div id="browse-categories-view" class="stagger-children"></div>
             </div>
        </div>
        
        <!-- VOTACI√ìN -->
        <div id="page-votaciones" class="page-content">
            <div class="container">
                <h2 class="section-title reveal-on-scroll">Votaciones 2025: EL DESEMPATE</h2>
                <div id="registration-container" class="reveal-on-scroll">
                    <h2>Muerte S√∫bita</h2>
                    <p style="color:#aaa;">Ingresa tus credenciales para decidir los empates.</p>
                    <div class="form-group"><label>Nombre</label><input type="text" id="reg-name" placeholder="Tu nombre"></div>
                    <div class="form-group"><label>Email (@gmail.com)</label><input type="email" id="reg-email" placeholder="tucorreo@gmail.com"></div>
                    <button id="start-voting-btn" class="btn">ENTRAR A DESEMPATE</button>
                </div>
                <div id="multi-step-container"></div>
            </div>
        </div>
    </main>
    
    <footer><p class="reveal-on-scroll">Premios Recreativos &copy; 2024.</p></footer>
    
    <div id="nominee-modal" class="modal"></div>
    <div id="cart-modal" class="modal">
        <div class="modal-content" style="background:#000;">
            <div class="cart-header">
                <h3 style="margin:0;color:white;">Tu Cesta</h3>
                <span style="font-size:2rem; cursor:pointer;" onclick="closeCartModal()">&times;</span>
            </div>
            <div class="cart-body" id="cart-items">
                <!-- Items inserted here -->
            </div>
            <div class="cart-total" id="cart-total">Total: 0,00‚Ç¨</div>
            <div class="cart-actions">
                <div id="cart-checkout-form" style="display:block;">
                    <input type="text" id="checkout-name" placeholder="Tu nombre" style="width:80%; padding:10px; margin-bottom:10px; border-radius:5px; border:1px solid #444; background:#111; color:white;">
                    <input type="email" id="checkout-email" placeholder="Tu Email de Contacto" style="width:80%; padding:10px; margin-bottom:10px; border-radius:5px; border:1px solid #444; background:#111; color:white;">
                    <button class="btn" onclick="submitOrder()">FINALIZAR COMPRA</button>
                </div>
                <div id="cart-success" style="display:none; color:var(--gold-acc); padding:20px;">
                    <h3>¬°Pedido Realizado!</h3>
                    <p>La organizaci√≥n ha recibido tu solicitud. Revisa tu correo.</p>
                </div>
            </div>
        </div>
    </div>
    
    <div id="gala-modal" class="modal"></div>
    <div id="lightbox" class="modal" onclick="this.classList.remove('active'); this.style.display='none';"></div>
    <div id="search-detail-modal" class="modal"></div>
    
    <!-- Cinematic Intro -->
    <div id="cinematic-intro"></div>

    <!-- Bal√≥n de Oro Video Transition -->
    <div id="balon-oro-overlay">
        <video id="balon-oro-video" muted playsinline>
            <source src="https://i.imgur.com/K45RVvg.mp4" type="video/mp4">
        </video>
    </div>

    <script>
    // --- L√ìGICA DE NIEVE ---
    let snowInterval = null;

    function createSnowflake() {
        const flake = document.createElement('div');
        flake.innerHTML = '‚ùÑ';
        flake.classList.add('snowflake');
        
        // Random properties
        const startLeft = Math.random() * window.innerWidth;
        const animationDuration = Math.random() * 3 + 2; 
        const size = Math.random() * 10 + 10;
        const opacity = Math.random() * 0.5 + 0.3;

        flake.style.left = startLeft + 'px';
        flake.style.animationDuration = animationDuration + 's';
        flake.style.fontSize = size + 'px';
        flake.style.opacity = opacity;
        
        document.body.appendChild(flake);
        setTimeout(() => { flake.remove(); }, animationDuration * 1000);
    }

    window.toggleSnow = function() {
        const btn = document.getElementById('snow-btn');
        if (snowInterval) {
            clearInterval(snowInterval);
            snowInterval = null;
            btn.style.background = 'rgba(255, 255, 255, 0.1)';
        } else {
            snowInterval = setInterval(createSnowflake, 100);
            btn.style.background = 'rgba(255, 255, 255, 0.5)';
            createSnowflake();
        }
    };

    // GLOBALS
    let cart = [];
    // Initialize EmailJS with your Public Key
    emailjs.init("3SD3SJudeACpVoC7R");

    window.openVoteLightbox = function(e, src) {
        e.preventDefault(); e.stopPropagation(); 
        const b = document.getElementById('lightbox');
        b.innerHTML = `<span class="modal-close-btn" onclick="this.parentElement.style.display='none'">&times;</span><div class="lightbox-content" style="display:flex;justify-content:center;align-items:center;height:100%;"><video src="${src}" controls autoplay style="max-width:100%;max-height:90vh;"></video></div>`;
        b.style.display='flex';
    };

    document.addEventListener('DOMContentLoaded', function() {
        
        // --- DATA ---
        let currentUser = null;
        let activeEditionYear = '2024';
        
        const galleryData = { 
            '2022': [{ src: 'https://i.imgur.com/TEvk01x.jpeg'},{ src: 'https://i.imgur.com/Nmw7Zpb.jpeg'},{ src: 'https://i.imgur.com/NdNR7VT.jpeg'},{ src: 'https://i.imgur.com/is6Be8i.jpeg'},{ src: 'https://i.imgur.com/xngizM1.jpeg'},{ src: 'https://i.imgur.com/lP2ndEf.jpeg'},{ src: 'https://i.imgur.com/7zB7Uzk.jpeg'},{ src: 'https://i.imgur.com/D3P0oQl.jpeg'},{ src: 'https://i.imgur.com/wQW5ndH.jpeg'}],
            '2023': [{ src: 'https://i.imgur.com/mRgZauW.jpeg'},{ src: 'https://i.imgur.com/7KUA9uU.jpeg'},{ src: 'https://i.imgur.com/958jJK3.jpeg'},{ src: 'https://i.imgur.com/9oWQ0I4.jpeg'},{ src: 'https://i.imgur.com/Wr6Vfu4.jpeg'},{ src: 'https://i.imgur.com/7vjohwR.jpeg'},{ src: 'https://i.imgur.com/noZGSHK.jpeg'},{ src: 'https://i.imgur.com/yCW1gUB.mp4'},{ src: 'https://i.imgur.com/z7BHgfE.mp4'},{ src: 'https://i.imgur.com/b111C8w.mp4'}],
            '2024': [{ src: 'https://i.imgur.com/YxYmZ5z.jpeg'},{ src: 'https://i.imgur.com/CJ0ZvpN.jpeg'},{ src: 'https://i.imgur.com/Ak5EDoI.jpeg'},{ src: 'https://i.imgur.com/D1P3HbA.mp4'},{ src: 'https://i.imgur.com/hFgf2Rj.jpeg'},{ src: 'https://i.imgur.com/A7Ir9Ea.jpeg'},{ src: 'https://i.imgur.com/di0Nh4g.jpeg'},{ src: 'https://i.imgur.com/qQMrANw.jpeg'},{ src: 'https://i.imgur.com/az1fkxz.jpeg'},{ src: 'https://i.imgur.com/Ak5EDoI.jpeg'}]
        };
        
        const nomineeData = [
            { id: 1, name: 'Yanis', type: 'Nominado', image: 'https://i.imgur.com/zRvVFAA.jpeg', description: 'El anfitri√≥n por excelencia. Doble ganador de "Casa Sola".', stats: { 'Fiabilidad': '5/10', 'Caos': '7/10', 'Ping': '15ms' }, nominations: ['Casa sola del a√±o (Ganador 2022, 2024)', 'Cumplea√±os del a√±o (Ganador 2024)', 'Conductor del a√±o (Ganador 2024)'] },
            { id: 2, name: 'Ra√∫l', type: 'Colaborador', image: 'https://i.imgur.com/TNjmhgO.jpeg', description: 'Leyenda retirada que escribe peor que un m√©dico.', stats: { 'Dislexia': '100', 'Torpe': '8/10', 'Legado': 'Inmortal' }, nominations: ['Persona con m√°s l√≠os (Ganador 2022, 2023)', 'Fum√≥n del a√±o (Ganador 2023)'] },
            { id: 3, name: 'Moreno', type: 'Nominado', image: 'https://i.imgur.com/J3yvKjB.jpeg', description: 'Paradoja humana: capaz de levantar 100kg y liar tabaco a la luz.', stats: { 'Fuerza': '10/10', 'Puntualidad': '5/10', 'Sarcasmo': '9/10' }, nominations: ['Liador del a√±o -Tabaco- (Ganador 2022)', 'GymBro del a√±o (Ganador 2024)', 'Decepci√≥n (Nom. 2024)'] },
            { id: 4, name: 'Luque', type: 'Nominado', image: 'https://i.imgur.com/4DUnPi9.jpeg', description: 'El Cazador vigente. Te saca la cartera con sonrisa diplom√°tica.', stats: { 'Diplomacia': '9/10', 'Catal√°n': '9/10' }, nominations: ['Cazador del a√±o (Ganador 2024)', 'Puro del A√±o (Nom. 2024)'] },
            { id: 5, name: 'Ramos', type: 'Colaborador', image: 'https://i.imgur.com/1El2gmu.jpeg', description: 'Fuerza de la naturaleza incontrolable y creador del PDR.', stats: { 'Energ√≠a': '10/10', 'Pelo': 'Bastante', 'Enfoque': 'Variable' }, nominations: ['Revelaci√≥n del a√±o (Nom. 2023)', 'Puro del A√±o (Nom. 2024)'] },
            { id: 6, name: 'Mora', type: 'Colaborador', image: 'https://i.imgur.com/OoboPSU.jpeg', description: 'El Guardiola del grupo y fundador del "Purismo".', stats: { 'Mandato': '10/10', 'F√∫tbol': 'No es malo' }, nominations: ['Pur√≠simo (Ganador 2022)', 'Puro del A√±o (Ganador 2023)'] },
            { id: 7, name: 'Alejandro (Netas)', type: 'Nominado', image: 'https://i.imgur.com/lPWLrT8.jpeg', description: 'Hombre orquesta: trabaja, bebe y juega Minecraft.', stats: { 'Trabajo': '10/10', 'H√≠gado': 'Blindado', 'Minecraft': 'Experto' }, nominations: ['Puro del A√±o (Ganador 2024)', 'Alcoh√≥lico (Ganador 2024)', 'Morao del a√±o (Ganador 2024)'] },
            { id: 8, name: '√Ålvaro Marcos', type: 'Nominado', image: 'https://i.imgur.com/8NSVzKd.jpeg', description: 'Depredador social. Su h√°bitat es la ruleta y el humo.', stats: { 'Persuasi√≥n': '9/10', 'Ruleta': '-100 ‚Ç¨' }, nominations: ['Trillad@r (Ganador 2022)', 'Cazador (Ganador 2023)', 'Fum√≥n (Ganador 2024)'] },
            { id: 9, name: 'Daniel', type: 'Colaborador', image: 'https://i.imgur.com/U9unDMV.jpeg', description: 'M√°s sibilino que Pedro S√°nchez. Estratega del caos.', stats: { 'Pol√©mico': '9/10', 'Pedro S√°nchez': 'La cabra' }, nominations: ['Alcoh√≥lico del a√±o (Ganador 2023)', 'Videojuego del a√±o -Fantasy- (Ganador 2023)'] },
            { id: 10, name: 'Tinez', type: 'Nominado', image: 'https://i.imgur.com/M3obz9D.jpeg', description: 'EL FRANC√âS. F√≠sico de dios, respuesta de piedra.', stats: { 'Timidez': '10/10', 'Responder': '0/10' }, nominations: ['Morao del a√±o (Nom. 2024)', 'Conductor del a√±o (Nom. 2024)', 'Puro del A√±o (Nom. 2024)'] },
            { id: 12, name: 'Seja', type: 'Nominado', image: 'https://i.imgur.com/p53nLfO.jpeg', description: 'El Peruano invisible. Ganador de "Menos visto".', stats: { 'Misterio': '10/10', 'Visibilidad': '1/10' }, nominations: ['Menos visto (Ganador 2024)'] },
            { id: 13, name: 'Alberto', type: 'Nominado', image: 'https://i.imgur.com/zLSBghe.jpeg', description: 'Experto en Rage Bait.', stats: { 'Rage Bait': '10/10', 'Qui√©n es m√°s gay': 'En aumento' }, nominations: ['Revelaci√≥n del a√±o (Ganador 2024)'] },
            { id: 14, name: 'Agulopi', type: 'Nominado', image: 'https://i.imgur.com/20OvXBO.jpeg', description: 'Tiene tanta cabeza que guard√≥ la Biblia dentro.', stats: { 'Cabeza': '10/10', 'Marvel Dreamer': 'En proceso' }, nominations: ['Multimedia -La Biblia- (Ganador 2024)', 'Cazador (Nom. 2024)', 'Revelaci√≥n (Nom. 2023)'] },
            { id: 15, name: 'Lorenzo', type: 'Nominado', image: 'https://i.imgur.com/AJgX4Yx.jpeg', description: 'Ley y Orden... hasta que se rompe el Tal√≥n de Aquiles.', stats: { 'Ley': '10/10', 'Tal√≥n de Aquiles': '-8' }, nominations: ['Revelaci√≥n del a√±o (Ganador 2023)', 'Morao del a√±o (Nom. 2024)'] },
            { id: 16, name: 'Luisma', type: 'Nominado', image: 'https://i.imgur.com/aqEUuqx.jpeg', description: 'Vive en un estado de empanamiento, pero con carisma.', stats: { 'Carisma': '9/10', 'Iniciativa': '7/10' }, nominations: ['Revelaci√≥n (Nom. 2024)', 'Cazador (Nom. 2024)'] },
            { id: 17, name: 'Miguel', type: 'Nominado', image: 'https://i.imgur.com/S39EArl.jpeg', description: 'El Terminator sensato. Conduce de lujo.', stats: { 'Esteroides': '10/10', 'Rodilla': 'Ninguna' }, nominations: ['GymBro del a√±o (Nom. 2024)', 'Conductor del a√±o (Nom. 2024)'] },
            { id: 18, name: 'Peaky', type: 'Invitado', image: 'https://i.imgur.com/Z7FyanE.jpeg', description: 'Mito viviente.', stats: { 'Sigilo': '10/10' }, nominations: ['Fantasma (2022)'] },
            { id: 26, name: 'Karine', type: 'Invitado', image: 'https://i.imgur.com/Z7FyanE.jpeg', description: 'Madre del a√±o.', stats: { 'Autoridad': '10/10' }, nominations: ['Madre (2023)'] },
            { id: 19, name: 'Piedad', type: 'Invitado', image: 'https://i.imgur.com/Z7FyanE.jpeg', description: 'Figura original.', stats: {}, nominations: [] },
            { id: 20, name: 'Sonia', type: 'Invitado', image: 'https://i.imgur.com/Z7FyanE.jpeg', description: 'Veterana inaugural.', stats: {}, nominations: [] },
            { id: 21, name: 'Helena', type: 'Invitado', image: 'https://i.imgur.com/Z7FyanE.jpeg', description: 'Ganadora.', stats: {}, nominations: ['Peor malito (2022)'] },
            { id: 22, name: 'Ana', type: 'Invitado', image: 'https://i.imgur.com/Z7FyanE.jpeg', description: 'Leyenda.', stats: {}, nominations: ['Alcoh√≥lic@ (2022)'] },
            { id: 23, name: 'Candela', type: 'Invitado', image: 'https://i.imgur.com/Z7FyanE.jpeg', description: 'Humor.', stats: {}, nominations: ['BURRE (2022)'] },
            { id: 27, name: 'Pablo Le√≥n', type: 'Invitado', image: 'https://i.imgur.com/Z7FyanE.jpeg', description: 'Notable.', stats: {}, nominations: [] },
            { id: 28, name: 'Ildefonso', type: 'Invitado', image: 'https://i.imgur.com/Z7FyanE.jpeg', description: 'Invitado de Honor.', stats: {}, nominations: [] },
            { id: 29, name: 'Carmen', type: 'Invitado', image: 'https://i.imgur.com/Z7FyanE.jpeg', description: 'Invitada de Honor.', stats: {}, nominations: [] }
        ];

        const galaData = {
            '2022': [{title:"Persona con m√°s l√≠os",nominees:[{name:"Ra√∫l",winner:!0,votes:11},{name:"Piedad",votes:3}]},{title:"Trillad@r del a√±o",nominees:[{name:"√Ålvaro Marcos",winner:!0,votes:10},{name:"Ra√∫l",votes:3}]},{title:"Peor malito del a√±o",nominees:[{name:"Helena",winner:!0,votes:8},{name:"Netas",votes:4}]},{title:"Cumplea√±os del a√±o",nominees:[{name:"Cumple Jes√∫s",winner:!0,votes:7},{name:"Piedad",votes:4}]},{title:"Evento del a√±o",nominees:[{name:"Feria",winner:!0,votes:7},{name:"Festivales",votes:4}]},{title:"Escapada del a√±o",nominees:[{name:"Casa rural 18 Mora",winner:!0,votes:5},{name:"La Antilla",votes:3}]},{title:"Fumador@ de canelos",nominees:[{name:"Mora",winner:!0,votes:10},{name:"Sonia",votes:2}]},{title:"Decepci√≥n del a√±o",nominees:[{name:"RaBos",winner:!0,votes:6},{name:"Seja",votes:4}]},{title:"BURRE DEL GRUPO",nominees:[{name:"Candela",winner:!0,votes:7},{name:"Yanis",votes:2}]},{title:"Casa sola del a√±o",nominees:[{name:"Yanis",winner:!0,votes:9},{name:"Netas",votes:4}]},{title:"Sitio del a√±o",nominees:[{name:"Caballo",winner:!0,votes:7},{name:"Casa San Antonio",votes:4}]},{title:"Liador del a√±o",nominees:[{name:"Moreno",winner:!0,votes:6},{name:"√Ålvaro Marcos",votes:4}]},{title:"Fantasma del a√±o",nominees:[{name:"Peaky",winner:!0,votes:7},{name:"Yanis",votes:5}]},{title:"PUR√çSIMO DE PUREZA",nominees:[{name:"Mora",winner:!0,votes:12},{name:"Sonia",votes:2}]}],
            '2023': [{title:"Madre del a√±o",nominees:[{name:"Karim",winner:!0,votes:7}]},{title:"Persona con m√°s l√≠os",nominees:[{name:"Ra√∫l",winner:!0,votes:8},{name:"√Ålvaro Marcos",votes:2}]},{title:"Peor morao del a√±o",nominees:[{name:"Mora",winner:!0,votes:8},{name:"Ra√∫l",votes:2}]},{title:"Cumplea√±os del a√±o",nominees:[{name:"Netas",winner:!0,votes:4},{name:"Agulopi",votes:2}]},{title:"Evento del a√±o",nominees:[{name:"Feria",winner:!0,votes:4},{name:"Graduaci√≥n Helena",votes:3}]},{title:"Fum√≥n del a√±o",nominees:[{name:"Ra√∫l",winner:!0,votes:7},{name:"√Ålvaro Marcos",votes:2}]},{title:"Alcoh√≥lico del a√±o",nominees:[{name:"Daniel",winner:!0,votes:5},{name:"Netas",votes:2}]},{title:"Revelaci√≥n del a√±o",nominees:[{name:"Lorenzo",winner:!0,votes:4},{name:"Ramos",votes:2}]},{title:"Mejor Casa Sola",nominees:[{name:"Yanis",winner:!0,votes:3},{name:"Luque",votes:3}]},{title:"Cazador del a√±o",nominees:[{name:"√Ålvaro Marcos",winner:!0,votes:7},{name:"Ra√∫l",votes:3}]},{title:"Videojuego del a√±o",nominees:[{name:"Fantasy",winner:!0,votes:5},{name:"Fortnite",votes:4}]},{title:"Sitio del a√±o",nominees:[{name:"Caballo",winner:!0,votes:5},{name:"Central",votes:3}]},{title:"PURO DEL A√ëO",nominees:[{name:"Mora",winner:!0,votes:4},{name:"Netas",votes:2}]}],
            '2024': [{title:"Menos visto",nominees:[{name:"Seja",winner:!0,votes:4},{name:"Miguel",votes:3}]},{title:"GymBro del a√±o",nominees:[{name:"Moreno",winner:!0,votes:4},{name:"Miguel",votes:3}]},{title:"Videojuego del a√±o",nominees:[{name:"Pokemon TCG",winner:!0,votes:4},{name:"LoL",votes:2}]},{title:"Multimedia del a√±o",nominees:[{name:"Historia familia",winner:!0,votes:4},{name:"Chavales apaleados",votes:3}]},{title:"Morao del a√±o",nominees:[{name:"Alejandro y diente",winner:!0,votes:5},{name:"Lorenzo",votes:2}]},{title:"Conductor del a√±o",nominees:[{name:"Yanis",winner:!0,votes:7},{name:"Daniel",votes:4}]},{title:"Evento del a√±o",nominees:[{name:"Islantilla 1",winner:!0,votes:5},{name:"C√°diz",votes:3}]},{title:"Cumplea√±os del a√±o",nominees:[{name:"Yanis",winner:!0,votes:7},{name:"Netas",votes:4}]},{title:"Cazador del a√±o",nominees:[{name:"Luque",winner:!0,votes:3},{name:"√Ålvaro Marcos",votes:3}]},{title:"Fum√≥n del a√±o",nominees:[{name:"√Ålvaro Marcos",winner:!0,votes:7},{name:"Luque",votes:2}]},{title:"Revelaci√≥n del a√±o",nominees:[{name:"Alberto",winner:!0,votes:4},{name:"Luisma",votes:3}]},{title:"Casa sola del a√±o",nominees:[{name:"Yanis",winner:!0,votes:5},{name:"Luque",votes:3}]},{title:"Alcoh√≥lico del a√±o",nominees:[{name:"Netas",winner:!0,votes:8},{name:"Yanis",votes:1}]},{title:"Tema del a√±o",nominees:[{name:"Bad Gyal",winner:!0,votes:3},{name:"Mr Moondial",votes:2}]},{title:"Decepci√≥n del a√±o",nominees:[{name:"Moreno",winner:!0,votes:4},{name:"Yanis",votes:3}]},{title:"PURO DEL A√ëO",nominees:[{name:"Netas",winner:!0,votes:6},{name:"Tinez",votes:4}]}]
        };

        const votingData = [
            {
                id: 0,
                title: "üéÆ Videojuego del a√±o (DESEMPATE)",
                description: "La batalla final. Ambos acabaron con 7 votos. Solo uno puede llevarse la gloria.",
                nominees: [
                    { name: "Pokemon PDR", imageOverride: "https://i.imgur.com/NyvZzPb.jpeg", position: "center" },
                    { name: "Dead by Daylight", imageOverride: "https://i.imgur.com/er8xdxh.jpeg", position: "center" }
                ]
            },
            {
                id: 1,
                title: "ü§ù Dupla del a√±o (DESEMPATE)",
                description: "Duelo de titanes empatados a 5 votos. ¬øEl gimnasio y la ley, o el rage bait puro?",
                nominees: [
                    { name: "Lorenzo y Moreno", imageOverride: "https://i.imgur.com/x1waLFX.jpeg", position: "center" },
                    { name: "Alberto y Miguel Orta", imageOverride: "https://i.imgur.com/YOkey2S.jpeg", position: "center" }
                ]
            },
            {
                id: 2,
                title: "‚úàÔ∏è Escapada del a√±o (DESEMPATE)",
                description: "Cazorla vs Islantilla 2. Ambos con 7 votos. Decidid el destino legendario definitivo.",
                nominees: [
                    { name: "Cazorla", imageOverride: "https://i.imgur.com/BDXn0Zm.jpeg" },
                    { name: "Islantilla 2", imageOverride: "https://i.imgur.com/6u7bMFU.jpeg" }
                ]
            }
        ];

        // --- SHOP PRODUCTS ---
        const shopProducts = [
            { 
                id: 'sobres_pack', 
                name: 'Sobre de 6 Cartas', 
                price: 0.50, 
                image: 'https://i.imgur.com/PORW6bs.jpeg', 
                description: 'La emoci√≥n de lo desconocido.' 
            },
            { 
                id: 'bundle_5', 
                name: 'Pack de 5 Sobres', 
                price: 1.00, 
                image: 'https://i.imgur.com/Iq6IXVN.jpeg', 
                description: 'Ahorra comprando el lote completo.' 
            },
            { 
                id: 'poster_digital', 
                name: 'P√≥ster Sorpresa (DIGITAL)', 
                price: 0.00, 
                image: 'https://i.imgur.com/9KCPRsr.jpeg', 
                description: 'Se enviar√° por correo en Alta Calidad. ¬°Descubre tu dise√±o!', 
                isPoster: true
            }
        ];

        // --- 2. LOGIC ---
        const scrollObserver = new IntersectionObserver((entries, obs) => {
            entries.forEach(e => { 
                if (e.isIntersecting) { 
                    e.target.classList.add("is-visible"); 
                    obs.unobserve(e.target); 
                } 
            });
        }, { threshold: 0.1 });

        const applyStagger = (selector, data, templateFn) => {
            const container = document.querySelector(selector);
            if (!container) return;
            container.innerHTML = data.map((item, index) => templateFn(item, index)).join('');
            container.querySelectorAll('.reveal-on-scroll').forEach(el => scrollObserver.observe(el));
        };

        const getNomineeImage = (name) => {
            const cleanName = name.includes('Videos') ? 'Tinez' : name.split(' ')[0];
            let found = nomineeData.find(n => n.name.includes(cleanName) || cleanName.includes(n.name));
            if(!found && (name.includes('Netas') || name.includes('Alejandro'))) found = nomineeData.find(n => n.id === 7);
            return found ? found.image : 'https://i.imgur.com/TpQo4hy.png';
        };

        const showPage = (targetId) => {
            document.querySelectorAll('.page-content.active').forEach(p => p.classList.remove('active'));
            const newPage = document.getElementById(targetId);
            if (newPage) {
                newPage.classList.add('active');
                newPage.querySelectorAll('.reveal-on-scroll:not(.is-visible)').forEach(el => scrollObserver.observe(el));
            }
            
            document.querySelectorAll('.desktop-nav a.active').forEach(a => a.classList.remove('active'));
            const link = document.querySelector(`.desktop-nav a[data-target="${targetId}"]`);
            if(link) link.classList.add('active');
            
            // Show/Hide Cart Button
            const cartBtn = document.getElementById('floating-cart-btn');
            if (targetId === 'page-tienda') {
                cartBtn.style.display = 'flex';
                renderShop();
            } else {
                cartBtn.style.display = 'none';
            }

            window.scrollTo(0,0);
            if(targetId === 'page-busqueda') renderCategoryExplorer();
            if(targetId === 'page-votaciones') initVoting();
        };

        document.getElementById('menu-toggle-btn').onclick = () => document.getElementById('mobile-nav').classList.toggle('nav-open');
        document.querySelectorAll('[data-target]').forEach(el => el.onclick = (e) => { 
            e.preventDefault(); showPage(el.dataset.target); document.getElementById('mobile-nav').classList.remove('nav-open'); 
        });

        // --- SHOP LOGIC ---
        const renderShop = () => {
            const container = document.getElementById('shop-container');
            if(container.innerHTML !== '') return;

            // Generate nominee options for the select (FILTRANDO INVITADOS)
            const nomineeOptions = nomineeData
                .filter(n => n.type !== 'Invitado')
                .map(n => `<option value="${n.name}">${n.name}</option>`)
                .join('');

            container.innerHTML = shopProducts.map((p, i) => {
                // Check if it is the special marble poster request
                let imageHtml = `<img src="${p.image}">`;
                if(p.id === 'poster_digital') {
                    // Although using an image, user asked for marble + gold question mark. 
                    // The provided link https://i.imgur.com/e4qadtA.jpeg seems to be that specific image.
                    // So standard image rendering works fine if the URL is correct.
                    imageHtml = `<div class="product-image"><img src="${p.image}" style="object-fit:cover;"></div>`;
                } else {
                    imageHtml = `<div class="product-image"><img src="${p.image}"></div>`;
                }

                return `
                <div class="product-card reveal-on-scroll" style="--stagger-delay:${i*0.1}s">
                    ${imageHtml}
                    <h3>${p.name}</h3>
                    <p style="color:#aaa; font-size:0.9rem;">${p.description}</p>
                    <div class="product-price">${p.price === 0 ? 'GRATIS' : p.price.toFixed(2) + '‚Ç¨'}</div>
                    
                    ${p.isPoster ? `<select id="poster-select" class="product-select"><option value="" disabled selected>Elige Leyenda...</option>${nomineeOptions}</select>` : ''}
                    
                    <button class="btn" onclick="addToCart('${p.id}')">A√±adir a Cesta</button>
                </div>
            `;}).join('');
            
            container.querySelectorAll('.reveal-on-scroll').forEach(el => scrollObserver.observe(el));
        };

        window.addToCart = (productId) => {
            const product = shopProducts.find(p => p.id === productId);
            if(!product) return;

            let finalName = product.name;
            
            if (product.isPoster) {
                const select = document.getElementById('poster-select');
                if(!select.value) { alert('Por favor, elige un nominado para el p√≥ster.'); return; }
                finalName = `${product.name} (${select.value})`;
            }

            cart.push({ ...product, displayName: finalName });
            updateCartUI();
            
            // Animacion boton flotante
            const btn = document.getElementById('floating-cart-btn');
            btn.style.transform = 'scale(1.3)';
            setTimeout(() => btn.style.transform = 'scale(1)', 200);
        };

        window.openCartModal = () => {
            renderCartItems();
            document.getElementById('cart-modal').style.display = 'flex';
        };

        window.closeCartModal = () => {
            document.getElementById('cart-modal').style.display = 'none';
        };

        function updateCartUI() {
            document.getElementById('cart-counter').innerText = cart.length;
        }

        function renderCartItems() {
            const container = document.getElementById('cart-items');
            if (cart.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#777; padding:20px;">La cesta est√° vac√≠a.</p>';
                document.getElementById('cart-total').innerText = 'Total: 0,00‚Ç¨';
                return;
            }

            let total = 0;
            container.innerHTML = cart.map((item, index) => {
                total += item.price;
                return `
                <div class="cart-item">
                    <div class="cart-item-info">
                        <strong>${item.displayName}</strong><br>
                        <span style="color:#aaa;">${item.price === 0 ? 'GRATIS' : item.price.toFixed(2) + '‚Ç¨'}</span>
                    </div>
                    <span class="remove-btn" onclick="removeFromCart(${index})">&times;</span>
                </div>`;
            }).join('');
            
            document.getElementById('cart-total').innerText = 'Total: ' + total.toFixed(2) + '‚Ç¨';
        }

        window.removeFromCart = (index) => {
            cart.splice(index, 1);
            updateCartUI();
            renderCartItems();
        };

        window.submitOrder = () => {
            if(cart.length === 0) return alert('La cesta est√° vac√≠a');
            const name = document.getElementById('checkout-name').value;
            const email = document.getElementById('checkout-email').value;

            if(!name) return alert('Por favor, introduce tu nombre.');
            if(!email || !email.includes('@')) return alert('Por favor, introduce un email v√°lido para contactarte.');
            
            // Format for Email (using same structure as voting template)
            const orderDetails = cart.map(i => `- ${i.displayName}: ${i.price === 0 ? 'GRATIS' : i.price.toFixed(2) + '‚Ç¨'}`).join('\n');
            const total = cart.reduce((acc, i) => acc + i.price, 0).toFixed(2);
            
            // Build the message body to fit in the template 'message' field
            const msgBody = `NUEVO PEDIDO DE TIENDA\n\nComprador: ${name}\nEmail de contacto: ${email}\n\n--- PEDIDO ---\n${orderDetails}\n\nTOTAL A PAGAR: ${total}‚Ç¨`;
            
            const btn = document.querySelector('#cart-checkout-form button');
            const originalText = btn.innerText;
            btn.innerText = "Enviando...";
            btn.disabled = true;

            // Use same service and template as voting
            emailjs.send('service_0xeyure', 'template_94djk1c', {
                to_name: "Admin (Pedidos)",
                from_name: name,
                from_email: email, 
                message: msgBody
            }).then(() => {
                document.getElementById('cart-checkout-form').style.display = 'none';
                document.getElementById('cart-success').style.display = 'block';
                cart = []; // Empty cart
                updateCartUI();
            }).catch(err => {
                console.error(err);
                alert('Hubo un error al enviar el pedido. Int√©ntalo de nuevo.');
                btn.innerText = originalText;
                btn.disabled = false;
            });
        };

        // --- EDITIONS ---
        window.changeEditionYear = (year) => {
            activeEditionYear = year;
            document.querySelectorAll('#editions-nav-container .filter-btn').forEach(b => {
                b.classList.toggle('active', b.innerText.includes(year));
            });
            renderGalaYearContent(year);
        };

        const renderEditions = () => {
            const container = document.getElementById('editions-nav-container');
            const years = Object.keys(galaData).reverse();
            if(container && container.innerHTML === '') {
                container.innerHTML = `<div class="filters-container reveal-on-scroll">${years.map(y => `<button class="filter-btn ${y===activeEditionYear?'active':''}" onclick="changeEditionYear('${y}')">EDICI√ìN ${y}</button>`).join('')}</div>`;
                scrollObserver.observe(container.firstChild);
            }
            renderGalaYearContent(activeEditionYear);
        };

        const renderGalaYearContent = (year) => {
            applyStagger('#editions-grid-container', galaData[year], (cat, i) => {
                const sorted = [...cat.nominees].sort((a,b) => (b.votes||0)-(a.votes||0));
                const total = sorted.reduce((sum,n)=>sum+(n.votes||0),0);
                
                return `
                <div class="reveal-on-scroll" style="--stagger-delay: ${i*0.1}s">
                    <div class="card clickable" onclick="
                        if(!this.classList.contains('state-nominees-revealed')){ this.classList.add('state-nominees-revealed'); }
                        else if(!this.classList.contains('state-winner-announced')){ this.classList.add('state-winner-announced'); }
                        else{ this.classList.remove('state-nominees-revealed','state-winner-announced'); }
                    ">
                        <div class="card-content-wrapper">
                            <h3>${cat.title}</h3>
                            <div class="results-comparison">
                                ${sorted.map((n, idx) => `
                                    <div class="nominee-result" ${idx===0?'data-winner="true"':''}>
                                        <img src="${getNomineeImage(n.name)}">
                                        <div><strong class="nominee-name-span">${n.name}</strong> ${total>0 ? Math.round(n.votes/total*100)+'%' : ''}</div>
                                    </div>
                                `).join('')}
                            </div>
                            <div style="text-align:center; font-size:0.7rem; opacity:0.7; margin-top:10px;">(Toca para revelar)</div>
                        </div>
                    </div>
                </div>`;
            });
        };

        // --- NOMINEES (FILTRADO MEJORADO) ---
        const renderNominees = () => {
            const activeBtn = document.querySelector('#nominee-filters .active');
            const filter = activeBtn ? activeBtn.getAttribute('data-filter') : 'all';
            
            const orgRoles = ['Organizaci√≥n', 'C√°mara', 'Colaborador'];

            const data = nomineeData.filter(n => {
                if (filter === 'all') return true;
                if (filter === 'Organizaci√≥n') return orgRoles.includes(n.type);
                return n.type === filter;
            });
            
            applyStagger('#nominee-grid-container', data, (n, i) => `
                <div class="reveal-on-scroll" style="--stagger-delay:${i*0.05}s">
                    <div class="nominee-card" data-id="${n.id}">
                        <img src="${n.image}">
                        <div class="nominee-info">${n.name}</div>
                    </div>
                </div>`);
        };
        
        // Listener Exclusivo para Nominados
        document.querySelectorAll('#nominee-filters .filter-btn').forEach(btn => {
            btn.onclick = function() { 
                const allBtns = document.querySelectorAll('#nominee-filters .filter-btn');
                allBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                renderNominees();
            };
        });

        // --- GALLERY ---
        const renderGallery = () => {
            const activeBtn = document.querySelector('#gallery-filters .active');
            const year = activeBtn ? activeBtn.innerText : '2024';
            
            const photos = galleryData[year] || [];
            
            const container = document.getElementById('gallery-grid-container');
            if(container) {
                container.innerHTML = photos.map((item, i) => {
                    const src = typeof item === 'object' ? item.src : item; 
                    const isVideo = src.endsWith('.mp4');
                    let content = '';

                    if (isVideo) {
                        content = `<video src="${src}" muted loop playsinline onmouseover="this.play()" onmouseout="this.pause()" style="width:100%;height:auto;display:block;"></video>
                                   <div class="gallery-overlay"><span class="gallery-caption">‚ñ∂</span></div>`;
                    } else {
                        content = `<img src="${src}" style="width:100%;height:auto;display:block;" loading="lazy">
                                   <div class="gallery-overlay"><span class="gallery-caption">VER</span></div>`;
                    }

                    return `
                    <div class="gallery-item-wrapper reveal-on-scroll" style="--stagger-delay:${i*0.05}s">
                        <div class="gallery-item" data-src="${src}">
                            ${content}
                        </div>
                    </div>`;
                }).join('');
                container.querySelectorAll('.reveal-on-scroll').forEach(el => scrollObserver.observe(el));
            }
        };
        
        const galFilterContainer = document.getElementById('gallery-filters');
        if (galFilterContainer) {
            galFilterContainer.querySelectorAll('.filter-btn').forEach(btn => {
                btn.onclick = function() {
                    const allBtns = galFilterContainer.querySelectorAll('.filter-btn');
                    allBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    renderGallery();
                };
            });
        }

        const openNomineeModal = (data) => {
            const m = document.getElementById('nominee-modal');
            const statsHtml = data.stats ? `<div class="nominee-stats-grid">${Object.entries(data.stats).map(([k,v]) => `<div class="stat-box"><h5>${k}</h5><span>${v}</span></div>`).join('')}</div>` : '';
            const histHtml = data.nominations.length ? `<div class="nominee-history"><h4>Historial</h4><ul>${data.nominations.map(h => `<li class="${h.includes('Ganador')?'win':''}">${h}</li>`).join('')}</ul></div>` : '';
            
            m.innerHTML = `<div class="modal-content">
                <span class="modal-close-btn" onclick="this.closest('.modal').classList.remove('active'); this.closest('.modal').style.display='none';">&times;</span>
                <div style="background-image:url('${data.image}'); background-size:cover; min-height:300px;"></div>
                <div class="nominee-modal-details">
                    <span style="background:var(--gold); color:#000; padding:4px 10px; border-radius:4px; font-weight:bold; display:inline-block; margin-bottom:10px;">${data.type}</span>
                    <h2>${data.name}</h2>
                    <p>${data.description}</p>
                    ${statsHtml} ${histHtml}
                </div>
            </div>`;
            m.style.display = 'flex'; setTimeout(()=>m.classList.add('active'), 10);
        };

        // --- BUSCADOR ---
        const renderCategoryExplorer = () => {
            const container = document.getElementById('browse-categories-view');
            const years = ['2025', '2024', '2023', '2022'];
            if(container) {
                container.innerHTML = years.map(y => {
                    const data = y === '2025' ? votingData : galaData[y];
                    return `
                    <div class="year-section reveal-on-scroll">
                        <h3 class="year-title">${y}</h3>
                        <div class="category-year-grid">
                            ${data.map(c => `<div class="category-card-minimal" data-year="${y}" data-title="${c.title.replace(/"/g,'&quot;')}"><h4>${c.title}</h4></div>`).join('')}
                        </div>
                    </div>`;
                }).join('');
                
                container.querySelectorAll('.category-card-minimal').forEach(el => {
                    el.onclick = () => {
                        const y = el.dataset.year;
                        if (y === '2025') { showPage('page-votaciones'); return; }
                        
                        const targetTitle = el.dataset.title;
                        showPage('page-ediciones');     
                        window.changeEditionYear(y);    

                        setTimeout(() => {
                             const grid = document.getElementById('editions-grid-container');
                             const allCards = Array.from(grid.querySelectorAll('.card'));
                             const targetCard = allCards.find(card => {
                                 return card.querySelector('h3').innerText.includes(targetTitle);
                             });

                             if (targetCard) {
                                 targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                 targetCard.classList.add('state-nominees-revealed');
                                 setTimeout(() => targetCard.classList.add('state-winner-announced'), 800);
                             }
                        }, 500); 
                    };
                });
                
                container.querySelectorAll('.reveal-on-scroll').forEach(el => scrollObserver.observe(el));
            }
        };

        document.getElementById('search-input').addEventListener('input', (e) => {
            const val = e.target.value.toLowerCase();
            const res = document.getElementById('search-results-container');
            const browse = document.getElementById('browse-categories-view');
            if (val.length < 2) { res.style.display='none'; browse.style.display='block'; return; }
            res.style.display='grid'; browse.style.display='none';
            
            const hits = [];
            nomineeData.forEach(n => {
                if(n.name.toLowerCase().includes(val)) hits.push({...n, searchType:'Nominado'});
            });
             ['2022','2023','2024'].forEach(y => {
                galaData[y].forEach(cat => {
                    if(cat.title.toLowerCase().includes(val)) {
                         hits.push({id:`cat-${y}-${cat.title}`, name: cat.title, type: `Categor√≠a ${y}`, searchType: 'Categor√≠a', year:y, title:cat.title});
                    }
                });
            });

            res.innerHTML = hits.map(h => `<li class="search-result-item" data-type="${h.searchType}" data-id="${h.id}" ${h.searchType==='Categor√≠a' ? `data-year="${h.year}" data-title="${h.title}"` : ''}><img src="${h.image || 'https://i.imgur.com/TpQo4hy.png'}"><div class="search-result-content"><div class="type">${h.type || h.searchType}</div><div class="title">${h.name}</div></div></li>`).join('');

             res.querySelectorAll('.search-result-item').forEach(item => {
                item.onclick = () => {
                     if(item.dataset.type === 'Nominado') {
                         showPage('page-nominados'); 
                         const nomFilters = document.querySelectorAll('#nominee-filters .filter-btn');
                         nomFilters.forEach(b => b.classList.remove('active'));
                         nomFilters[0].classList.add('active'); 
                         renderNominees(); 
                         setTimeout(() => {
                             const targetId = item.dataset.id;
                             const targetCard = document.querySelector(`.nominee-card[data-id="${targetId}"]`);
                             if (targetCard) {
                                 targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                 openNomineeModal(nomineeData.find(n => n.id == targetId));
                             }
                         }, 500);
                     } else {
                        const y = item.dataset.year;
                        const title = item.dataset.title;
                        showPage('page-ediciones');
                        window.changeEditionYear(y);
                        setTimeout(() => {
                             const grid = document.getElementById('editions-grid-container');
                             const allCards = Array.from(grid.querySelectorAll('.card'));
                             const targetCard = allCards.find(card => card.querySelector('h3').innerText.includes(title));
                             if (targetCard) {
                                 targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                 targetCard.classList.add('state-nominees-revealed');
                                 setTimeout(() => targetCard.classList.add('state-winner-announced'), 800);
                             }
                        }, 500);
                     }
                };
            });
        });

        // --- VOTACI√ìN ---
        const votes = {};

        const initVoting = () => {
            const reg = document.getElementById('registration-container');
            const form = document.getElementById('multi-step-container');
            const intro = document.getElementById('cinematic-intro');
            
            if (currentUser) { reg.style.display='none'; form.style.display='block'; renderSteps(); return; }
            
            reg.style.display='block'; form.style.display='none';
            
            document.getElementById('start-voting-btn').onclick = () => {
                const name = document.getElementById('reg-name').value;
                const email = document.getElementById('reg-email').value;
                
                if(name && email.endsWith('@gmail.com')) {
                    currentUser = { name, email };
                    emailjs.init("3SD3SJudeACpVoC7R");
                    
                    reg.style.display = 'none';
                    
                    if(!document.getElementById('cinematic-intro')) {
                        const i = document.createElement('div'); i.id='cinematic-intro'; 
                        document.body.appendChild(i);
                    }
                    const cIntro = document.getElementById('cinematic-intro');
                    cIntro.innerHTML = '<h1 class="intro-text">PREMIOS RECREATIVOS<br>MUERTE S√öBITA</h1>';
                    cIntro.className = 'playing'; 
                    cIntro.style.display = 'flex';
                    
                    setTimeout(() => {
                        cIntro.style.display = 'none'; 
                        cIntro.classList.remove('playing');
                        form.style.display='block'; 
                        renderSteps();
                    }, 3500); 
                    
                } else {
                    alert('Introduce nombre y un GMAIL v√°lido.');
                }
            };
        };

        const renderSteps = () => {
            const cont = document.getElementById('multi-step-container');
            const showStep = (idx) => {
                cont.innerHTML = `
                    <div class="progress-bar-container"><div id="progress-bar" style="width:${((idx+1)/votingData.length)*100}%"></div></div>
                    <div class="form-step active">
                        <h3>${votingData[idx].title}</h3>
                        <p style="text-align:center;color:#ccc;margin-bottom:20px;">${votingData[idx].description || ''}</p>
                        <div class="voting-options-grid ${votingData[idx].title.toLowerCase().includes('dupla') ? 'mode-wide' : ''}">${votingData[idx].nominees.map(nom => {
                            let img = nom.imageOverride || getNomineeImage(nom.name);
                            const isMp4 = img.includes('.mp4');
                            const posStyle = (nom.position === 'center') ? 'object-position: center center;' : 'object-position: top center;';
                            const media = isMp4 
                                ? `<video src="${img}" muted loop playsinline onmouseover="this.play()" onmouseout="this.pause()" style="width:100%;height:100%;object-fit:cover;object-position:${nom.position==='center'?'center':'top'}"></video>`
                                : `<img src="${img}" style="${posStyle}">`;
                            const btn = isMp4 
                                ? `<div class="vote-watch-btn" onclick="openVoteLightbox(event, '${img}')">VER CON SONIDO üîä</div>` 
                                : '';
                            return `<label class="voting-option-wrapper"><input type="radio" name="cat_${idx}" value="${nom.name}" ${votes[idx]===nom.name?'checked':''}>
                                <div class="voting-card">
                                    ${media}
                                    ${btn}
                                    <div class="voting-card-overlay"><h4>${nom.name}</h4><p>${nom.description||''}</p></div>
                                </div>
                            </label>`;
                        }).join('')}</div>
                        <div class="form-navigation"><button class="btn" onclick="prevVotingStep(${idx})">ANTERIOR</button><button class="btn" onclick="nextVotingStep(${idx})">${idx===votingData.length-1?'ENVIAR VOTOS':'SIGUIENTE'}</button></div>
                    </div>`;
                
                window.prevVotingStep = (i) => i>0 ? showStep(i-1) : null;
                window.nextVotingStep = (i) => {
                    const selected = document.querySelector(`input[name="cat_${idx}"]:checked`);
                    if(!selected) return alert('Selecciona una opci√≥n');
                    votes[idx] = selected.value;
                    const nextIdx = idx + 1;
                    if (nextIdx < votingData.length) {
                        if (votingData[nextIdx].special === 'balon-oro') {
                            const overlay = document.getElementById('balon-oro-overlay');
                            const vid = document.getElementById('balon-oro-video');
                            overlay.style.display = 'flex';
                            setTimeout(()=>overlay.style.opacity='1', 50);
                            vid.currentTime = 0;
                            vid.play();
                            setTimeout(() => {
                                overlay.style.opacity = '0';
                                setTimeout(() => {
                                    overlay.style.display='none';
                                    showStep(nextIdx);
                                    window.scrollTo(0,0);
                                }, 500);
                            }, 4000); 
                        } else {
                            showStep(nextIdx);
                            window.scrollTo(0,0);
                        }
                    } else {
                        submitVotes();
                    }
                };
            };
            
            const submitVotes = () => {
                cont.innerHTML = '<div style="text-align:center; padding:50px;"><h2 style="color:white">Enviando Votos...</h2></div>';
                const body = Object.keys(votes).map(k => `${votingData[k].title}: ${votes[k]}`).join('\n');
                emailjs.send('service_0xeyure', 'template_94djk1c', {
                    to_name: "Admin",
                    from_name: currentUser.name,
                    from_email: currentUser.email,
                    message: body
                }).then(() => {
                    cont.innerHTML = '<div id="thank-you-step"><h2 style="color:var(--gold)">¬°VOTOS REGISTRADOS!</h2><p>Gracias por participar.</p></div>';
                }).catch(err => {
                    alert('Error enviando. Intenta de nuevo.');
                    renderSteps(votingData.length-1);
                });
            };

            showStep(0);
        };

        const openSearchDetailModal = (data) => {
            const m = document.getElementById('search-detail-modal');
            m.innerHTML = `<div class="modal-content"><span class="modal-close-btn" onclick="this.closest('.modal').style.display='none'">&times;</span><div style="padding:40px;"><img src="${data.image}"><h2 style="font-family:'Playfair Display'; color:var(--gold); margin-bottom:10px;">${data.title}</h2><p style="text-align:center;">Ganador: ${data.pastWinners.length ? data.pastWinners[0].name : '?'}</p></div></div>`;
            m.style.display='flex'; setTimeout(()=>m.classList.add('active'),10);
        };

        document.addEventListener('click', (e) => {
            const card = e.target.closest('.nominee-card');
            if(card && !e.target.closest('.voting-options-grid')) {
                openNomineeModal(nomineeData.find(n => n.id == card.dataset.id));
            }
            const gItem = e.target.closest('.gallery-item');
            if(gItem) {
                const src = gItem.dataset.src;
                const b = document.getElementById('lightbox');
                
                const isVid = src.endsWith('.mp4');
                const content = isVid 
                    ? `<video src="${src}" controls autoplay style="max-width:100%;max-height:100%;"></video>` 
                    : `<img src="${src}" style="max-width:100%;max-height:100%;">`;

                b.innerHTML = `<span class="modal-close-btn" onclick="this.parentElement.style.display='none'">&times;</span><div class="lightbox-content" style="display:flex;justify-content:center;align-items:center;height:100%;">${content}</div>`;
                b.style.display='flex';
            }
            if (e.target.closest('.modal-close-btn')) {
                const m = e.target.closest('.modal');
                m.classList.remove('active'); 
                setTimeout(()=>m.style.display='none',300);
            }
        });

        // INIT
        showPage('page-inicio');
        renderEditions();
        renderNominees();
        renderGallery();
        document.querySelectorAll('.reveal-on-scroll').forEach(el => scrollObserver.observe(el));
    });
    </script>
</body>
</html>